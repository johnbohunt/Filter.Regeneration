import processing.serial.*;

Serial arduino;
String comPort;
ArrayList<String> arduinoLines;
PrintWriter outputFile;

void setup() {
  size(400, 200);
  arduinoLines = new ArrayList<String>();
  
  // Connect to Arduino
  String[] ports = Serial.list();
  if (ports.length > 0) {
    comPort = ports[0];
    arduino = new Serial(this, comPort, 9600);
    println("Arduino connected on " + comPort);
  } else {
    println("Arduino not found.");
    exit();
  }
  
  // Create a file for storing the lines
  outputFile = createWriter("arduino_output.txt");
}

void draw() {
  // Read incoming lines from Arduino
  while (arduino.available() > 0) {
    String line = arduino.readStringUntil('\n');
    if (line != null) {
      // Timestamp the line
      String timestampedLine = getTimeStamp() + ": " + line.trim();
      arduinoLines.add(timestampedLine);
      println(timestampedLine);
      // Write the line to the output file
      outputFile.println(timestampedLine);
      outputFile.flush();
    }
  }
}

void keyPressed() {
  // Close the output file when "ESC" key is pressed
  if (keyCode == ESC) {
    outputFile.close();
    exit();
  }
}

String getTimeStamp() {
  return nf(hour(), 2) + ":" + nf(minute(), 2) + ":" + nf(second(), 2);
}
